# CommuniTAP

A Laravel-based community task and engagement platform with authentication, task management, incident reporting, and rewards system.

## üìã Table of Contents

- [Prerequisites](#prerequisites)
- [Required Libraries & Dependencies](#required-libraries--dependencies)
- [Installation](#installation)
- [Configuration](#configuration)
- [Database Setup](#database-setup)
- [Running the Application](#running-the-application)
- [Development Workflow](#development-workflow)
- [Authentication & Authorization](#authentication--authorization)
- [API Documentation](#api-documentation)
- [Troubleshooting](#troubleshooting)

## Prerequisites

Before you begin, ensure you have the following installed on your system:

- **PHP 8.2+** (with required extensions: mbstring, xml, curl, zip, gd, pdo, pdo_mysql)
- **Composer** (PHP dependency manager)
- **Node.js 18+** (with npm)
- **MySQL 8+** or **SQLite** (for database)
- **Git** (for cloning the repository)

### PHP Extensions

Make sure the following PHP extensions are enabled:
- `mbstring`
- `xml`
- `curl`
- `zip`
- `gd`
- `pdo`
- `pdo_mysql` (if using MySQL)
- `sqlite3` (if using SQLite)

## Required Libraries & Dependencies

### PHP Dependencies (Composer)

The project uses the following PHP packages (automatically installed via `composer install`):

#### Production Dependencies:
- **laravel/framework** ^12.0 - Laravel framework
- **barryvdh/laravel-dompdf** ^3.1 - PDF generation library
- **laravel/sanctum** ^4.2 - API authentication (token-based)
- **laravel/tinker** ^2.10.1 - REPL for Laravel

#### Development Dependencies:
- **laravel/breeze** ^2.3 - Authentication scaffolding
- **laravel/pail** ^1.2.2 - Log viewer
- **laravel/pint** ^1.24 - Code style fixer
- **laravel/sail** ^1.41 - Docker development environment
- **pestphp/pest** ^3.8 - Testing framework
- **pestphp/pest-plugin-laravel** ^3.2 - Pest Laravel plugin
- **fakerphp/faker** ^1.23 - Fake data generator
- **mockery/mockery** ^1.6 - Mocking framework
- **nunomaduro/collision** ^8.6 - Error handler

### JavaScript/Node Dependencies (npm)

The project uses the following Node packages (automatically installed via `npm install`):

#### Development Dependencies:
- **vite** ^7.0.4 - Build tool and dev server
- **laravel-vite-plugin** ^2.0.0 - Laravel Vite integration
- **tailwindcss** ^3.1.0 - CSS framework
- **@tailwindcss/forms** ^0.5.2 - Tailwind forms plugin
- **@tailwindcss/vite** ^4.0.0 - Tailwind Vite plugin
- **alpinejs** ^3.4.2 - Lightweight JavaScript framework
- **axios** ^1.11.0 - HTTP client
- **autoprefixer** ^10.4.2 - CSS post-processor
- **postcss** ^8.4.31 - CSS transformer
- **concurrently** ^9.0.1 - Run multiple commands concurrently

## Installation

### 1. Clone the Repository

```bash
git clone https://github.com/allenkim115/CommuniTAP.git
cd communitap
```

### 2. Install PHP Dependencies

```bash
composer install
```

**Note for Windows users:** If you encounter archive write failures during `composer install` on Windows, use:

```bash
composer install --prefer-source
```

### 3. Install JavaScript Dependencies

```bash
npm install
```

### 4. Environment Configuration

Create the `.env` file from the example file (if it exists) or create it manually:

```bash
# If .env.example exists:
# Linux/Mac
cp .env.example .env

# Windows PowerShell
cp .env.example .env

# Windows Command Prompt
copy .env.example .env

# If .env.example doesn't exist, create .env manually and add the configuration below
# Then generate application key
php artisan key:generate
```

**Note:** If `.env.example` doesn't exist in the repository, create a `.env` file manually in the root directory and configure it using the [Environment Variables](#environment-variables) section below.

## Configuration

### Environment Variables

Edit the `.env` file and configure the following settings:

```env
APP_NAME=CommuniTAP
APP_ENV=local
APP_KEY=base64:... (generated by key:generate)
APP_DEBUG=true
APP_URL=http://127.0.0.1:8000

# Database Configuration (MySQL)
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=communitap
DB_USERNAME=root
DB_PASSWORD=

# Or use SQLite (default)
# DB_CONNECTION=sqlite
# DB_DATABASE=/absolute/path/to/database/database.sqlite

# Session Configuration
SESSION_DRIVER=file
SESSION_LIFETIME=120

# Cache Configuration
CACHE_STORE=file

# Queue Configuration
QUEUE_CONNECTION=sync

# Mail Configuration (if needed)
MAIL_MAILER=smtp
MAIL_HOST=mailpit
MAIL_PORT=1025
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null
MAIL_FROM_ADDRESS="hello@example.com"
MAIL_FROM_NAME="${APP_NAME}"

# Sanctum Configuration (for SPA/cookie-based auth)
SANCTUM_STATEFUL_DOMAINS=127.0.0.1:5173
SESSION_DOMAIN=127.0.0.1
```

## Database Setup

### Option 1: MySQL

1. Create a MySQL database:

```sql
CREATE DATABASE communitap CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
```

2. Update your `.env` file with MySQL credentials:

```env
DB_CONNECTION=mysql
DB_HOST=127.0.0.1
DB_PORT=3306
DB_DATABASE=communitap
DB_USERNAME=root
DB_PASSWORD=your_password
```

### Option 2: SQLite (Default)

SQLite is configured as the default database. The database file is located at `database/database.sqlite`. If it doesn't exist, it will be created automatically during migration.

### Run Migrations

After configuring your database, run the migrations:

```bash
php artisan migrate
```

### Seed Database (Optional)

To populate the database with initial data (admin user, sample data):

```bash
php artisan db:seed
```

Or seed specific seeders:

```bash
php artisan db:seed --class=AdminUserSeeder
php artisan db:seed --class=IncidentReportSeeder
php artisan db:seed --class=TapNominationSeeder
```

### Create Storage Link

Create a symbolic link for file storage:

```bash
php artisan storage:link
```

This links `storage/app/public` to `public/storage` for public file access.

## Running the Application

### Development Mode

#### Option 1: Separate Terminals

Terminal 1 - Laravel server:
```bash
php artisan serve
```

Terminal 2 - Vite dev server (for assets):
```bash
npm run dev
```

#### Option 2: Single Command (Recommended)

The project includes a convenient dev script that runs all services concurrently:

```bash
composer run dev
```

This command runs:
- Laravel development server
- Queue worker
- Log viewer (Pail)
- Vite dev server

### Production Build

For production, build the assets:

```bash
npm run build
```

Then serve the application:

```bash
php artisan serve
```

### Access the Application

Open your browser and navigate to:
- **Application:** http://127.0.0.1:8000
- **Admin Dashboard:** http://127.0.0.1:8000/admin (if configured)

**Note:** The first registered user becomes an admin automatically.

## Development Workflow

### Code Style

The project uses Laravel Pint for code formatting:

```bash
# Format code
./vendor/bin/pint

# Check code style without making changes
./vendor/bin/pint --test
```

### Testing

Run tests using Pest:

```bash
# Run all tests
php artisan test

# Or use composer script
composer run test

# Run specific test
php artisan test --filter TestName
```

### Clear Cache

If you encounter caching issues:

```bash
# Clear application cache
php artisan cache:clear

# Clear config cache
php artisan config:clear

# Clear route cache
php artisan route:clear

# Clear view cache
php artisan view:clear

# Clear all caches
php artisan optimize:clear
```

## Authentication & Authorization

### Web Authentication (Laravel Breeze)

The application uses Laravel Breeze for web authentication with:
- Session-based login
- User registration
- Password reset
- Email verification (if configured)

### API Authentication (Laravel Sanctum)

Laravel Sanctum is configured for API token-based authentication. Personal access tokens are enabled for programmatic access (mobile/SPA/CLI).

### Authorization

The application includes the following policies:
- **TaskPolicy** - Controls task creation, update, and deletion (admin-only by default)
- **IncidentReportPolicy** - Controls incident report access

### Middleware

- `admin` - Admin-only routes (e.g., routes under `prefix('admin')`)
- `user` - Blocks admins from accessing user-only pages

## API Documentation

### Base URL

```
http://127.0.0.1:8000/api
```

### Authentication Endpoints

#### Login

```http
POST /api/login
Content-Type: application/json

{
  "email": "user@example.com",
  "password": "password",
  "device_name": "postman" // optional
}
```

**Response:**
```json
{
  "token": "1|xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx",
  "user": {
    "id": 1,
    "name": "User Name",
    "email": "user@example.com"
  }
}
```

#### Get Authenticated User

```http
GET /api/me
Authorization: Bearer {token}
Accept: application/json
```

**Response:**
```json
{
  "id": 1,
  "name": "User Name",
  "email": "user@example.com"
}
```

#### Logout

```http
POST /api/logout
Authorization: Bearer {token}
Accept: application/json
```

### Example Usage (cURL)

```bash
# Login
curl -X POST http://127.0.0.1:8000/api/login \
  -H "Accept: application/json" \
  -H "Content-Type: application/json" \
  -d '{"email":"user@example.com","password":"password","device_name":"postman"}'

# Get user info
curl http://127.0.0.1:8000/api/me \
  -H "Accept: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"

# Logout
curl -X POST http://127.0.0.1:8000/api/logout \
  -H "Accept: application/json" \
  -H "Authorization: Bearer YOUR_TOKEN_HERE"
```

## Troubleshooting

### Common Issues

#### Missing APP_KEY
```bash
php artisan key:generate
```

#### Unstyled Pages
Make sure Vite dev server is running:
```bash
npm run dev
```

Or build assets for production:
```bash
npm run build
```

#### Files Not Loading
Create the storage link:
```bash
php artisan storage:link
```

#### Database Connection Errors
1. Verify database credentials in `.env`
2. Ensure database exists
3. Check database server is running
4. For MySQL, verify user has proper permissions

#### Permission Errors (Linux/Mac)
Set proper permissions:
```bash
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache
```

#### Composer Install Fails on Windows
Use source install:
```bash
composer install --prefer-source
```

#### Node Modules Issues
Clear npm cache and reinstall:
```bash
rm -rf node_modules package-lock.json
npm cache clean --force
npm install
```

#### Migration Errors
Reset database (‚ö†Ô∏è **Warning:** This will delete all data):
```bash
php artisan migrate:fresh
php artisan db:seed
```

### Getting Help

If you encounter issues not listed here:
1. Check Laravel logs: `storage/logs/laravel.log`
2. Enable debug mode in `.env`: `APP_DEBUG=true`
3. Clear all caches: `php artisan optimize:clear`
4. Check server requirements: `php artisan about`

## Project Structure

```
communitap/
‚îú‚îÄ‚îÄ app/                 # Application code
‚îÇ   ‚îú‚îÄ‚îÄ Http/           # Controllers, Middleware, Requests
‚îÇ   ‚îú‚îÄ‚îÄ Models/         # Eloquent models
‚îÇ   ‚îú‚îÄ‚îÄ Policies/       # Authorization policies
‚îÇ   ‚îî‚îÄ‚îÄ Providers/      # Service providers
‚îú‚îÄ‚îÄ config/             # Configuration files
‚îú‚îÄ‚îÄ database/           # Migrations, seeders, factories
‚îÇ   ‚îú‚îÄ‚îÄ migrations/     # Database migrations
‚îÇ   ‚îî‚îÄ‚îÄ seeders/        # Database seeders
‚îú‚îÄ‚îÄ public/             # Public assets
‚îú‚îÄ‚îÄ resources/          # Views, CSS, JavaScript
‚îÇ   ‚îú‚îÄ‚îÄ views/          # Blade templates
‚îÇ   ‚îú‚îÄ‚îÄ css/            # CSS files
‚îÇ   ‚îî‚îÄ‚îÄ js/             # JavaScript files
‚îú‚îÄ‚îÄ routes/             # Route definitions
‚îú‚îÄ‚îÄ storage/            # Storage files
‚îú‚îÄ‚îÄ tests/              # Tests
‚îî‚îÄ‚îÄ vendor/             # Composer dependencies
```

## License

This project is open-sourced software licensed under the [MIT license](https://opensource.org/licenses/MIT).

## Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## Support

For support, email support@example.com or open an issue in the repository.
